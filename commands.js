/*! For license information please see commands.js.LICENSE.txt */
!function(){function e(){var n,o,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function a(e,r,i,c){var a=r&&r.prototype instanceof f?r:f,u=Object.create(a.prototype);return t(u,"_invoke",function(e,t,r){var i,c,a,f=0,u=r||[],l=!1,p={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return i=e,c=0,a=n,p.n=t,s}};function m(e,t){for(c=e,a=t,o=0;!l&&f&&!r&&o<u.length;o++){var r,i=u[o],m=p.p,y=i[2];e>3?(r=y===t)&&(c=i[4]||3,a=i[5]===n?i[3]:i[5],i[4]=3,i[5]=n):i[0]<=m&&((r=e<2&&m<i[1])?(c=0,p.v=t,p.n=i[1]):m<y&&(r=e<3||i[0]>t||t>y)&&(i[4]=e,i[5]=t,p.n=y,c=0))}if(r||e>1)return s;throw l=!0,t}return function(r,u,y){if(f>1)throw TypeError("Generator is already running");for(l&&1===u&&m(u,y),c=u,a=y;(o=c<2?n:a)||!l;){i||(c?c<3?(c>1&&(p.n=-1),m(c,a)):p.n=a:p.v=a);try{if(f=2,i){if(c||(r="next"),o=i[r]){if(!(o=o.call(i,a)))throw TypeError("iterator result is not an object");if(!o.done)return o;a=o.value,c<2&&(c=0)}else 1===c&&(o=i.return)&&o.call(i),c<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),c=1);i=n}else if((o=(l=p.n<0)?a:e.call(t,p))!==s)break}catch(e){i=n,c=1,a=e}finally{f=1}}return{value:o,done:l}}}(e,i,c),!0),u}var s={};function f(){}function u(){}function l(){}o=Object.getPrototypeOf;var p=[][i]?o(o([][i]())):(t(o={},i,(function(){return this})),o),m=l.prototype=f.prototype=Object.create(p);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,t(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=l,t(m,"constructor",l),t(l,"constructor",u),u.displayName="GeneratorFunction",t(l,c,"GeneratorFunction"),t(m),t(m,c,"Generator"),t(m,i,(function(){return this})),t(m,"toString",(function(){return"[object Generator]"})),(e=function(){return{w:a,m:y}})()}function t(e,n,o,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,n,o,r){if(n)i?i(e,n,{value:o,enumerable:!r,configurable:!r,writable:!r}):e[n]=o;else{var c=function(n,o){t(e,n,(function(e){return this._invoke(n,o,e)}))};c("next",0),c("throw",1),c("return",2)}},t(e,n,o,r)}function n(e,t,n,o,r,i,c){try{var a=e[i](c),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(o,r)}Office.onReady((function(){})),Office.actions.associate("action",(function(t){Office.context.mailbox.item.notificationMessages.addAsync("llmProcessing",{type:Office.MailboxNotificationMessageType.InformationalMessage,message:"Generating reply with AI...",icon:"Icon.80x80",persistent:!0});try{Office.context.mailbox.item.body.getAsync("html",function(){var o,r=(o=e().m((function n(o){var r,i,c,a,s,f,u,l;return e().w((function(e){for(;;)switch(e.n){case 0:if(o.status!==Office.AsyncResultStatus.Succeeded){e.n=7;break}return r=o.value,i={email_body:r,query:"Please reply to this e-mail, ***ONLY OUTPUT THE E-MAIL*** "},c="⚠️ Could not generate a response from AI.",e.p=1,e.n=2,fetch("http://localhost:8082/api/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 2:if((s=e.v).ok){e.n=3;break}throw new Error("Server responded with status ".concat(s.status,": ").concat(s.statusText));case 3:return e.n=4,s.json();case 4:f=e.v,c=(null===(a=f.result)||void 0===a?void 0:a.answer)||c,e.n=6;break;case 5:e.p=5,l=e.v,console.error("Error calling LLM backend:",l),c="❌ Error communicating with AI: ".concat(l.message),Office.context.mailbox.item.notificationMessages.addAsync("llmBackendError",{type:Office.MailboxNotificationMessageType.ErrorMessage,message:c,icon:"Icon.80x80",persistent:!0});case 6:Office.context.mailbox.item.displayReplyForm(c),Office.context.mailbox.item.notificationMessages.removeAsync("llmProcessing"),Office.context.mailbox.item.notificationMessages.addAsync("llmSuccess",{type:Office.MailboxNotificationMessageType.InformationalMessage,message:"AI reply draft created!",icon:"Icon.80x80",persistent:!1}),e.n=8;break;case 7:u="Failed to extract email body: ".concat(o.error.message),console.error(u),Office.context.mailbox.item.notificationMessages.removeAsync("llmProcessing"),Office.context.mailbox.item.notificationMessages.addAsync("bodyReadError",{type:Office.MailboxNotificationMessageType.ErrorMessage,message:u,icon:"Icon.80x80",persistent:!0});case 8:t.completed();case 9:return e.a(2)}}),n,null,[[1,5]])})),function(){var e=this,t=arguments;return new Promise((function(r,i){var c=o.apply(e,t);function a(e){n(c,r,i,a,s,"next",e)}function s(e){n(c,r,i,a,s,"throw",e)}a(void 0)}))});return function(e){return r.apply(this,arguments)}}())}catch(e){console.error("An unexpected error occurred in AI action:",e),Office.context.mailbox.item.notificationMessages.removeAsync("llmProcessing"),Office.context.mailbox.item.notificationMessages.addAsync("unexpectedError",{type:Office.MailboxNotificationMessageType.ErrorMessage,message:"An unexpected error occurred: ".concat(e.message),icon:"Icon.80x80",persistent:!0}),t.completed()}}))}();
//# sourceMappingURL=commands.js.map